{{ define "main" }}

{{ partial "components/page-header.html" . }}

<section class="section pb-5">
  <div class="container container-delta">
    {{ with .Params.contact }}
    <div class="row mb-5">
      <div class="col-xl-6 col-lg-8 mx-auto text-start text-lg-center">
        <div class="section-title mb-0">
          {{ with .subtitle }}<p class="subtitle">{{ . | markdownify }}</p>{{ end }}
          <h1 class="title text-xl mb-3">{{ .title | markdownify }}</h1>
          {{ with .description }}<p>{{ . | markdownify }}</p>{{ end }}
        </div>
      </div>
    </div>
    {{ end }}

    <div class="row justify-content-center">
      <div class="col-xl-8 col-lg-9 mx-auto order-1 order-lg-0">

        <form id="contact-form" method="POST"
              class="rounded-md shadow-md p-4 p-md-5"
              action="https://api.web3forms.com/submit">

          <!-- Web3Forms -->
          <input type="hidden" name="access_key" value="a66be1cc-5738-4d70-93a5-747110165ab5">
          <!-- redirect localizzato -->
          <input type="hidden" name="redirect" value="{{ "thanks/" | relLangURL | absURL }}">
          <input type="hidden" name="subject"  value="[Contact] Website inquiry">

          <!-- Honeypot (anti-bot) -->
          <input type="checkbox" name="botcheck" class="d-none" tabindex="-1" autocomplete="off" style="display:none">

          <!-- What are you interested in -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="interest">{{ i18n "contact_interest_label" }}</label>
            <select class="form-control text-dark shadow-none" id="interest" name="interest" required>
              <option value="" selected disabled>{{ i18n "contact_interest_placeholder" }}</option>
              <option>{{ i18n "contact_interest_demo" }}</option>
              <option>{{ i18n "contact_interest_product" }}</option>
              <option>{{ i18n "contact_interest_partner" }}</option>
              <option>{{ i18n "contact_interest_media" }}</option>
              <option>{{ i18n "contact_interest_academic" }}</option>
              <option>{{ i18n "contact_interest_other" }}</option>
            </select>
          </div>

          <!-- First name -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="fname">{{ i18n "contact_fname" }}</label>
            <input class="form-control text-dark shadow-none" type="text" placeholder="{{ i18n "contact_fname" }}"
                   id="fname" name="first_name" required>
          </div>

          <!-- Last name -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="lname">{{ i18n "contact_lname" }}</label>
            <input class="form-control text-dark shadow-none" type="text" placeholder="{{ i18n "contact_lname" }}"
                   id="lname" name="last_name" required>
          </div>

          <!-- Company -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="company">{{ i18n "contact_company" }}</label>
            <input class="form-control text-dark shadow-none" type="text" placeholder="Acme S.p.A."
                   id="company" name="company" required>
          </div>

          <!-- Email -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="email">{{ i18n "contact_email" }}</label>
            <input class="form-control text-dark shadow-none" type="email" placeholder="example@domain.io"
                   id="email" name="email" required>
          </div>

          <!-- Phone (optional) -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="phone">{{ i18n "contact_phone" }}</label>
            <input class="form-control text-dark shadow-none" type="tel" id="phone" name="phone"
                   inputmode="tel" placeholder="{{ i18n "contact_phone_placeholder" }}"
                   pattern="^\+?[0-9\s\-\(\)]{7,}$"
                   title="Enter a valid phone number (min. 7 digits; +, spaces, dashes and parentheses allowed)">
          </div>

          <!-- Message -->
          <div class="form-group mb-3">
            <label class="fw-600 text-dark mb-1" for="message">{{ i18n "contact_message" }}</label>
            <textarea class="form-control text-dark shadow-none" rows="5" id="message" name="message"
                      required placeholder="{{ i18n "contact_message" }}…"></textarea>
          </div>

          <!-- Privacy consent -->
          <div class="form-group mb-3 form-check">
            <input class="form-check-input" type="checkbox" id="privacy" required>
            <label class="form-check-label" for="privacy">
              {{ i18n "contact_privacy_label_html" }}
              <a href="{{ (or .Site.Params.privacy_page.url "/privacy/") | relLangURL }}"
                target="_blank" rel="noopener">privacy policy</a>.
            </label>
          </div>


          <!-- hCaptcha -->
          <div class="form-group mb-3">
            <div class="h-captcha" data-captcha="true" data-lang="{{ .Site.Language.Lang }}"></div>
          </div>

          <!-- Submit -->
          <button class="btn btn-primary w-100" id="submit-btn" type="submit">{{ i18n "contact_submit" }}</button>

        </form>

        <!-- Web3Forms client script to load hCaptcha -->
        <script src="https://web3forms.com/client/script.js" async defer></script>

        <script>
        (function () {
          const form = document.getElementById('contact-form');
          const btn  = document.getElementById('submit-btn');
          let submitting = false;

          form.addEventListener('submit', function (e) {
            const cap = form.querySelector('input[name="h-captcha-response"], textarea[name="h-captcha-response"]');
            if (!cap || !cap.value) {
              e.preventDefault();
              alert('{{ i18n "contact_captcha_alert" }}');
              return false;
            }
            const now  = Date.now();
            const last = Number(localStorage.getItem('contact_last_submit') || 0);
            if (now - last < 15000) { e.preventDefault(); return false; }
            localStorage.setItem('contact_last_submit', String(now));
            if (submitting) { e.preventDefault(); return false; }
            submitting = true;
            btn.disabled = true;
            btn.setAttribute('aria-busy', 'true');
            btn.classList.add('disabled');
            btn.textContent = '{{ i18n "contact_submit" }}…';
            const ts = document.createElement('input');
            ts.type = 'hidden'; ts.name = 'submitted_at'; ts.value = new Date().toISOString();
            form.appendChild(ts);
          }, { capture: true });
        })();
        </script>

      </div>
    </div>
  </div>

  <style>
    .form-control { padding-bottom: 0rem; padding-top: 0rem; }
  </style>
</section>

{{ end }}
