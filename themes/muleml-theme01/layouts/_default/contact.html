{{ define "main" }}

{{ partial "components/page-header.html" . }}

<section class="section pb-5">
  <div class="container container-delta">
    {{with .Params.contact}}
    <div class="row mb-5">
      <div class="col-xl-6 col-lg-8 mx-auto text-start text-lg-center">
        <div class="section-title mb-0">
          {{with .subtitle}}<p class="subtitle">{{. | markdownify}}</p>{{end}}
          <h1 class="title text-xl mb-3">{{.title | markdownify}}</h1>
          {{with .description}}<p>{{. | markdownify}}</p>{{end}}
        </div>
      </div>
    </div>
    {{end}}
    <div class="row justify-content-center">
      <div class="col-xl-8 col-lg-9 mx-auto order-1 order-lg-0">

            <form id="contact-form" method="POST"
                class="rounded-md shadow-md p-4 p-md-5"
                action="https://api.web3forms.com/submit">

            <!-- Web3Forms -->
            <input type="hidden" name="access_key" value="a66be1cc-5738-4d70-93a5-747110165ab5">
            <input type="hidden" name="redirect"   value="{{ .Site.BaseURL }}thanks/">
            <input type="hidden" name="subject"    value="[Contact] Website inquiry">

            <!-- Honeypot (anti-bot) -->
            <input type="checkbox" name="botcheck" class="d-none" tabindex="-1" autocomplete="off" style="display:none">

            <!-- What are you interested in -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="interest">What are you interested in</label>
              <select class="form-control text-dark shadow-none" id="interest" name="interest" required>
                <option value="" selected disabled>Select…</option>
                <option>Demo</option>
                <option>Product information</option>
                <option>Partnership opportunity</option>
                <option>Media inquiry</option>
                <option>Academic collaboration</option>
                <option>Other</option>
              </select>
            </div>

            <!-- First name -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="fname">First name</label>
              <input class="form-control text-dark shadow-none" type="text" placeholder="Jack"
                    id="fname" name="first_name" required>
            </div>

            <!-- Last name -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="lname">Last name</label>
              <input class="form-control text-dark shadow-none" type="text" placeholder="Barker"
                    id="lname" name="last_name" required>
            </div>

            <!-- Company -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="company">Company</label>
              <input class="form-control text-dark shadow-none" type="text" placeholder="Acme S.p.A."
                    id="company" name="company" required>
            </div>

            <!-- Email -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="email">Email</label>
              <input class="form-control text-dark shadow-none" type="email" placeholder="example@domain.io"
                    id="email" name="email" required>
            </div>

            <!-- Phone (optional) -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="phone">Phone (optional)</label>
              <input class="form-control text-dark shadow-none" type="tel" id="phone" name="phone"
                    inputmode="tel" placeholder="+39 333 123 4567"
                    pattern="^\+?[0-9\s\-\(\)]{7,}$"
                    title="Enter a valid phone number (min. 7 digits; +, spaces, dashes and parentheses allowed)">
            </div>

            <!-- Message -->
            <div class="form-group mb-3">
              <label class="fw-600 text-dark mb-1" for="message">Message</label>
              <textarea class="form-control text-dark shadow-none" rows="5" id="message" name="message"
                        required placeholder="Write your message…"></textarea>
            </div>

            <!-- Privacy consent -->
            <div class="form-group mb-3 form-check">
              <input class="form-check-input" type="checkbox" id="privacy" required>
              <label class="form-check-label" for="privacy">
                I have read and accept the <a href="/privacy/" target="_blank" rel="noopener">privacy policy</a>.
              </label>
            </div>

            <!-- hCaptcha (Web3Forms zero-config) -->
            <div class="form-group mb-3">
              <div class="h-captcha" data-captcha="true" data-lang="en"></div>
            </div>

            <!-- Submit -->
            <button class="btn btn-primary w-100" type="submit">Submit</button>

            <!-- (Optional) inline messages are handled by the /thanks/ page via redirect -->
          </form>

          <!-- Web3Forms client script to load hCaptcha -->
          <script src="https://web3forms.com/client/script.js" async defer></script>

          <script>
          (function () {
            const form = document.getElementById('contact-form');
            const btn  = document.getElementById('submit-btn');
            let submitting = false;

            form.addEventListener('submit', function (e) {

              /* ✅ CHECK CAPTCHA: hCaptcha aggiunge automaticamente
                un campo hidden 'h-captcha-response' quando l'utente completa il captcha */
              const cap = form.querySelector('input[name="h-captcha-response"], textarea[name="h-captcha-response"]');
              if (!cap || !cap.value) {
                e.preventDefault();
                alert('Please complete the captcha.');
                return false;
              }


              // throttle: blocca invii entro 15s dallo stesso browser
              const now = Date.now();
              const last = Number(localStorage.getItem('contact_last_submit') || 0);
              if (now - last < 15000) {
                e.preventDefault();
                return false;
              }
              localStorage.setItem('contact_last_submit', String(now));

              // anti double-click
              if (submitting) {
                e.preventDefault();
                return false;
              }
              submitting = true;

              // disabilita bottone e mostra stato
              btn.disabled = true;
              btn.setAttribute('aria-busy', 'true');
              btn.classList.add('disabled');           // opzionale (Bootstrap)
              btn.textContent = 'Sending…';

              // (facoltativo) metti un timestamp nella submission
              const ts = document.createElement('input');
              ts.type = 'hidden';
              ts.name = 'submitted_at';
              ts.value = new Date().toISOString();
              form.appendChild(ts);

              // nessun preventDefault: lasciamo proseguire la submit con redirect
            }, { capture: true });
          })();
          </script>


      </div>


    </div>
  </div>

<style>
  .form-control {
    padding-bottom: 0rem;
    padding-top: 0rem; /* solo qui */
  }
</style>

</section>


{{ end }}
